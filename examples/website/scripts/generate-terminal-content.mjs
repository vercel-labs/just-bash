#!/usr/bin/env node

/**
 * Generates terminal-content.ts from the main repo files.
 * Run this before build to update the embedded content.
 */

import fs from "node:fs";
import path from "node:path";
import { fileURLToPath } from "node:url";

const __dirname = path.dirname(fileURLToPath(import.meta.url));
const repoRoot = path.resolve(__dirname, "../../..");
const outputFile = path.resolve(
  __dirname,
  "../app/components/terminal-content.ts"
);

// Read repo files
const readme = fs.readFileSync(path.join(repoRoot, "README.md"), "utf-8");
const license = fs.readFileSync(path.join(repoRoot, "LICENSE"), "utf-8");
const packageJson = JSON.parse(
  fs.readFileSync(path.join(repoRoot, "package.json"), "utf-8")
);
const agentsMd = fs.readFileSync(path.join(repoRoot, "AGENTS.md"), "utf-8");

// Escape backticks and ${} for template literals
function escapeTemplate(str) {
  return str.replace(/\\/g, "\\\\").replace(/`/g, "\\`").replace(/\$\{/g, "\\${");
}

// Generate simplified package.json
const simplifiedPackageJson = JSON.stringify(
  {
    name: packageJson.name,
    version: packageJson.version,
    description: packageJson.description,
    repository: packageJson.repository,
    homepage: packageJson.homepage,
    type: packageJson.type,
    main: packageJson.main,
    types: packageJson.types,
    author: packageJson.author,
    license: packageJson.license,
  },
  null,
  2
);

const content = `// Auto-generated by scripts/generate-terminal-content.mjs
// Do not edit manually - run "pnpm generate" to regenerate

import pkg from "../../../../package.json";

export const version = pkg.version;

// Command outputs
export const CMD_ABOUT = \`just-bash v\${pkg.version}
A TypeScript bash interpreter with in-memory filesystem.
Designed for AI agents needing a secure, sandboxed environment.

Custom commands:
  about       About just-bash
  install     Installation instructions
  github      GitHub repository

Or try any bash command: ls, cat, echo, grep, awk, jq, sed, etc.
Type 'help' for a list of all built-in commands.
\`;

export const CMD_INSTALL = \`npm install just-bash

Usage:
  import { Bash } from "just-bash";
  const bash = new Bash();
  const result = await bash.exec("echo hello");
\`;

export const CMD_GITHUB = "https://github.com/vercel-labs/just-bash\\n";

// File contents (generated from repo)
export const FILE_README = \`${escapeTemplate(readme)}\`;

export const FILE_LICENSE = \`${escapeTemplate(license)}\`;

export const FILE_PACKAGE_JSON = \`${escapeTemplate(simplifiedPackageJson)}\`;

export const FILE_AGENTS_MD = \`${escapeTemplate(agentsMd)}\`;
`;

fs.writeFileSync(outputFile, content);
console.log(`Generated ${outputFile}`);
